# cmake-spdx

This is still very early / exploratory (and doesn't actually have any SPDX yet).

## Exploring the CMake file API

CMake file API responses were generated by creating an empty file with the following path, in a Zephyr `build/` directory prior to running the build:

`.cmake/api/v1/query/codemodel-v2`

Then, after running the build, CMake generated JSON files with the build / target data at:

`.cmake/api/v1/reply/`

The JSON files from this build are available in this repo in the [`/api-example-reply/api/v1/reply/`](/api-example-reply/api/v1/reply) directory.

## Parsing the API responses

The Python files in this repo are set up to parse the CMake file API JSON responses, and to reassemble the data into the corresponding data model in memory.

To run it, run `python main.py <index.json>`, where `<index.json>` is the path to the [index file](/api-example-reply/api/v1/reply/index-2020-08-29T18-34-19-0138.json) from the API responses.

At present, this parses the JSON files (index => codemodel => targets) and loads them into memory, but doesn't actually do anything with them yet.

## Next steps

* create an SPDX file corresponding to the build artifacts (e.g., SPDX File sections corresponding to the built files)
* use the parsed CMake data to create SPDX relationships between the build artifacts (e.g., which files are linked to which others?)
* create an SPDX file corresponding to the original sources
* use the parsed CMake data to create SPDX relationships from the build artifacts to the original sources (e.g., which source(s) are used to generate a particular binary?)

## License

Apache-2.0
